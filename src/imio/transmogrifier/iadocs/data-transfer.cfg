# Prerequis:
# créer utilisateur csvimport
# régler les numéros initiaux de fiches

# mandatory section !
[config]
debug = 0
# needed if contact encoding group is enabled in Plone
creating_group =
raise_on_error = 1
internal_number_behavior_types = organization person held_position dmsincomingmail dmsincoming_email dmsoutgoingmail
data_transfer_behavior_types = dmsincomingmail dmsincoming_email dmsoutgoingmail
none_value = NULL
creator = csvimport
default_i_mail_type = courrier
default_o_mail_type = courrier
default_o_send_mode = post
default_contact = contacts/reprise-de-donnees "Reprise de données"
to_treat = 10
# CHANGE l__1_type_insert FOR EACH CUSTOMER

[transmogrifier]
pipeline =
    initialization
    a__service_match_read
    a__service_match_store
    a__1_service_read
#    a__1_service_check
    a__plone_service_write
    a__service_match_write
    a__service_update
# bb  mail type and send mode configuration
    b__mailtype_match_read
    b__1_mailtype_match_check
    b__mailtype_match_store
    b__1_mail_read
#    b__1_mail_reject
    b__1_used_nature_store
    b__1_used_source_store
    b__1_mailtype_read
    b__mailtype_used_only
    b__1_mailtype_check
    b__plone_mailtype_write
    b__1_mailtype_by_type
    b__mailtype_match_write
    b__mailtype_update
# cc  users
    c__1_user_match_read
    c__user_match_store
    c__1_user_read
    c__plone_user_write
    c__1_user_match_write
# dd  personnel held_position for OM sender
    d__need_c
    dm__1_contacts_read
    dm__1_contacts_userid_only
    dm__1_contacts_store
    d__1_mail_read
    d__1_S_only
    d__om_sender_creation
# ee  classification categories
    e__category_full_match_read
    e__category_full_match_store
    e__category_match_read
    e__1_category_match_check
    e__1_mail_read
    e__1_folder_read
    e__1_category_reject
    e__1_store_used_category
    e__1_category_read
#    e__1_category_code_modify  # comblain
    e__1_category_check
    e__category_store
    e__category_load
    e__category_used_only
#    e__category_not_in_plone
    e__plone_category_write
    e__category_matched_add
    e__category_match_write
    e__category_update
    e__category_create
    e__category_full_match_write
# ff  classification folders
#    f__folder_match_read
#    f__folder_match_store
    fs__1_folder_read
    fs__1_folder_check
    f__folder_matched_uid_add
    f__folder_matched_folder_info_add
    f__folder_service_uid_add
    f__folder_service_name_add
    f__plone_folder_write
    f__folder_match_write

# hh  directory configuration
    h__contact_type_match_read
    h__contact_type_match_store
    h__1_contacts_read
    h__1_used_contact_type_store
    h__1_contact_type_read
    h__contact_type_used_only
    h__plone_contact_type_write
    h__contact_type_match_write
    h__contact_type_update

# ii  contacts
    i__need
    ilpq__1_contacts_read
    i__pickle_c_w
    ilpq__1_contacts_check
    i__type_inserter
    i__1_parent_relation_store
    ilpq__1_contacts_store
    i__dependency_sorter
    i__1_contacts_load
    i__1_id_insert
    i__1_parent_insert
    i__1_path_insert

# ll  IM & IEM handling
    l__need
    l__1_mail_read
    l__pickle_i_w
    l__1_E_only
    l__batched
    l__count
    l__1_mail_check
    l__modification_date_insert
    l__reception_date_insert
    l__original_mail_date_insert
    l__1_internal_number_insert
    l__1_comblain_service_id_correct
    l__treating_groups_insert
    l__1_recipient_groups_set
    l__1_category_id_insert
    l__default_contact_set
    l__1_sender_as_text_set
    l__mail_type_insert
    l__1_nature_insert
    l__mail_type2_insert
    l__1_source_insert
    l__1_meetingitem_link_insert
    l__1_confidential_insert
    l__1_remark_insert
    l__1_id_insert
    l__1_type_insert
    l__1_parent_insert
    l__1_path_insert
#     l__to_correct_only
#     l__filter_item

# mm  IM & IEM recipients
    m__need
#     m__user_service_read
#     m__user_service_store
    mt__pickle_i_r
    m__1_mail_recipient_read
    m__1_already_only
    m__1_mail_recipient_check
#    m__1_principal_only
#     m__batched
    m__count
    m__1_assigned_user

# pp  OM handling
    p__need
#     lp__1_contacts_read
    p__1_mail_read
    p__pickle_o_w
    p__1_S_only
    p__batched
    p__count
    p__1_mail_check
    p__modification_date_insert
    p__outgoing_date_insert
    p__mail_date_insert
    p__1_internal_number_insert
    p__1_comblain_service_id_correct
    p__treating_groups_insert
    p__1_recipient_groups_set
#    p__assigned_user ?
    p__1_sender_set
    p__default_contact_set
    p__1_category_id_insert
    p__mail_type_insert
    p__1_nature_insert
    p__send_modes_insert
    p__1_source_insert
    p__1_meetingitem_link_insert
    p__1_confidential_insert
    p__1_remark_insert
    p__1_id_insert
    p__1_type_insert
    p__1_parent_insert
    p__1_path_insert
#    p__to_correct_only
#    p__filter_item

# qq  OM recipients
#    q__need
    qu__pickle_o_r
    q__1_mail_recipient_read
    q__1_already_only
    q__1_mail_recipient_check
#     q__1_principal_only
#     q__batched
    q__count
    q__1_recipients

# ss classification folders assignments
#     s__need
    sx__pickle_i_r
    sx__pickle_o_r
    s__1_folder_store
    s__pickle_mail_folder_w
    s__1_mail_folder_read
    s__1_already_only
    s__batched
    s__1_classification_folders_update
    s__count
    s__1_batch_store

# tt  IM files
#    t__need
    t__pickle_file_i_w
#     t__1_mail_read
#     t__1_E_only
#     t__1_store_mail
    tu__1_dmsfile_read
    t__1_already_only
#     t__1_i_only
    t__batched
    t__1_upload_date_modify
    t__1_dmsfile_check
    t__1_with_path
    t__1_dmsfile_creation
    t__1_path_insert
    t__count

# uu  OM files
#    u__need
    u__pickle_file_o_w
    u__1_already_only
    u__batched
    u__1_upload_date_modify
    u__1_dmsfile_check
    u__1_with_path
    u__1_dmsfile_creation
    u__1_path_insert
    u__count

# xx  IM/OM links
#    x__need
    x__pickle_mail_link_w
    x__1_mail_link_read
    x__1_already_only
    x__batched
    x__1_reply_to_update
    x__count
    x__1_batch_store

# constructors
    creators_insert
    constructor
#    1__service_correct
    schemaupdater
    datesupdater
    ownerset
    l__state_set
    p__state_set
    reindexobject
    workflowupdater
    workflow_history_update
    short_log
    commit_count
    post_actions
    breakpoint
    lastsection

[disable_versioning]
blueprint = plone.app.transmogrifier.versioning.disable

[initialization]
blueprint = imio.transmogrifier.iadocs.init
# basepath is an absolute directory. If empty, buildout dir will be used
basepath =
# if subpath, it will be appended to basepath
subpath = imports
# if empty it will be subpath full path
csvpath = dt_csv_dir
filespath = dt_files_dir

# = = = = = = =  aa  = = = = = = = #

[a__service_match_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
b_condition = python: modules['os'].path.exists(filename)
# filename is relative to csvpath
filename = 1_service_match.csv
fieldnames = eid eparent etitle uid title
bp_key = e_service_match
# none_value = ${config:none_value}
# csv_headers = python:True
# csv_encoding = utf8
# dialect = excel
# fmtparam-strict = python:True
# fmtparam-delimiter = python:','
# raise_on_error = ${config:raise_on_error}

[a__service_match_store]
blueprint = imio.transmogrifier.iadocs.store_in_data
condition = python: item.get('_bpk') == u'e_service_match'
bp_key = e_service_match
store_key = eid
fieldnames = etitle uid title
yield = 0

[a__1_service_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('a__service_match_read', {}).get('filename', '_not_found_')))
              or transmogrifier.storage['parts'] == 'a'
filename = eServices.csv
fieldnames = _A _eid _title _pid _E _F _G _H _I _J _code _L _M _N _O _P _Q _R _S _T _U _V _W _X _Y _Z _AA _AB _AC _AD _AE _AF _AG _AH _AI _AJ _AK _AL _AM _AN _AO _AP _AQ _AR
bp_key = e_service

[a__1_service_check]
blueprint = imio.transmogrifier.iadocs.common_input_checks
bp_key = e_service
condition = python: item.get('_bpk') == u'e_service'
raise_on_error = ${config:raise_on_error}

[a__plone_service_write]
blueprint = imio.transmogrifier.iadocs.csv_writer
b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('a__service_match_read', {}).get('filename', '_not_found_')))
filename = 0_imio_service.csv
fieldnames = uid ft t
headers = uid full_title title
bp_key = p_orgs_all
# if store_key, the printed value is not the item but the values in storage['data'][{bp_key}]. The key is considered as store_key field
store_key = uid
store_key_sort = ft

[a__service_match_write]
blueprint = imio.transmogrifier.iadocs.csv_writer
b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('a__service_match_read', {}).get('filename', '_not_found_')))
condition = python: item.get('_bpk') == 'e_service'
filename = 0_service_match.csv
fieldnames = _eid _pid title
headers = eid parent_eid etitle uid full_title
bp_key = 0_service_match

[a__service_update]
blueprint = imio.transmogrifier.iadocs.a_service_update
condition = python: item.get('_bpk') == u'e_service'

# = = = = = = =  bb  = = = = = = = #

[b__mailtype_match_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
b_condition = python: modules['os'].path.exists(filename)
filename = 1_mailtype_match.csv
fieldnames = _eid _etype _etitle _enature _esource _c_type _key _title _active
bp_key = e_mailtype_match

[b__1_mailtype_match_check]
blueprint = imio.transmogrifier.iadocs.common_input_checks
bp_key = e_mailtype_match
condition = python: item.get('_bpk') == u'e_mailtype_match'
booleans = _enature _esource _active

[b__mailtype_match_store]
blueprint = imio.transmogrifier.iadocs.store_in_data
condition = python: item.get('_bpk') == u'e_mailtype_match'
bp_key = e_mailtype_match
store_key = _eid
store_subkey = _etype
fieldnames = _enature _esource _etitle _c_type _key _title _active
yield = 1

[b__1_mail_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('b__mailtype_match_read', {}).get('filename', '_not_found_')))
filename = eCourriers.csv
fieldnames = _A _eid _C reception_date original_mail_date external_reference_no due_date _nature_id _sender_id _sender _service title _remark _etype _O classification_categories
             _Q _R _S _T _U _to_del _W _source _source_id _Z
             _AA _AB _AC _AD _AE _AF _AG _AH _AI _AJ _AK _AL _AM _AN _AO _AP _AQ _AR _AS _AT _AU _AV _AW _AX _AY _AZ
             _BA _BB _BC _BD _BE _BF _BG _BH _BI _BJ _version _BL _BM
bp_key = e_mail_mailtype

[b__1_mail_reject]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'b') and item.get('_bpk') == 'e_mail_mailtype'
condition2 = python: item.get('_etype') in ('E', 'S') and str(item['_to_del']) != '1'

[b__1_used_nature_store]
blueprint = imio.transmogrifier.iadocs.store_in_data
condition = python: item.get('_bpk') == u'e_mail_mailtype'
bp_key = e_used_mailtype
store_key = _nature_id
store_subkey = _etype
fieldnames = _eid
yield = 1

[b__1_used_source_store]
blueprint = imio.transmogrifier.iadocs.store_in_data
condition = python: item.get('_bpk') == u'e_mail_mailtype'
bp_key = e_used_mailtype
store_key = _source_id
store_subkey = _etype
fieldnames = _eid
yield = 0

[b__1_mailtype_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('b__mailtype_match_read', {}).get('filename', '_not_found_')))
filename = eNatures.csv
fieldnames = _A _eid _etitle _D _nature _source _G _H _I _J _K _L _M _N _O
bp_key = e_mailtype

[b__mailtype_used_only]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'b') and item.get('_bpk') == u'e_mailtype'
condition2 = python: item.get('_eid') in storage['data'].get('e_used_mailtype', [])

[b__1_mailtype_check]
blueprint = imio.transmogrifier.iadocs.common_input_checks
bp_key = e_mailtype
condition = python: item.get('_bpk') == u'e_mailtype'
booleans = _nature _source
raise_on_error = ${config:raise_on_error}

[b__plone_mailtype_write]
blueprint = imio.transmogrifier.iadocs.csv_writer
b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('b__mailtype_match_read', {}).get('filename', '_not_found_')))
filename = 0_imio_mailtype.csv
fieldnames = type value dtitle active
headers = type key title active
bp_key = p_mailtype
store_key = type
store_subkey = value
store_key_sort =

[b__1_mailtype_by_type]
blueprint = imio.transmogrifier.iadocs.b_1_mailtype_by_type
condition = python: not storage['data'].get('e_mailtype_match') and item.get('_bpk') == 'e_mailtype'
related_storage = e_used_mailtype

[b__mailtype_match_write]
blueprint = imio.transmogrifier.iadocs.csv_writer
b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('b__mailtype_match_read', {}).get('filename', '_not_found_')))
condition = python: item.get('_bpk') == 'e_mailtype'
filename = 0_mailtype_match.csv
fieldnames = _eid _etype _etitle _nature _source
headers = eid etype etitle nature source type key title active
bp_key = 0_mailtype_match
yield = 0  # TODO  check at next run

[b__mailtype_update]
blueprint = imio.transmogrifier.iadocs.b_mailtype_update
condition = python: item['_bpk'] == u'e_mailtype_match'

# = = = = = = =  cc  = = = = = = = #

[c__1_user_match_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
b_condition = python: modules['os'].path.exists(filename)
filename = 1_user_match.csv
fieldnames = _eid _nom _prenom _p_userid _fullname
bp_key = e_user_match

[c__user_match_store]
blueprint = imio.transmogrifier.iadocs.store_in_data
condition = python: item.get('_bpk') == u'e_user_match'
bp_key = e_user_match
store_key = _eid
fieldnames = _nom _prenom _p_userid _fullname
yield = 0

[c__1_user_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('c__1_user_match_read', {}).get('filename', '_not_found_')))
filename = eUsers.csv
fieldnames = _A _eid _elogin _D _active _F _G _H _I _J _K _L _M _N _O _P _Q _R _S _T _nom _prenom _W _X _Y _Z
             _AA _AB _AC _AD _AE _AF _AG _AH _AI _AJ _AK _AL _AM _AN _AO _AP _AQ _AR _AS _AT _AU _AV _AW _AX _AY _AZ
             _BA _BB _BC _BD _BE _BF _BG _BH _BI _BJ _BK _BL _BM _BN _BO _BP _BQ _BR _BS _BT _BU _BV _BW _BX _BY _BZ
             _CA _CB _CC _CD _CE _CF _CG _CH _CI _CJ _CK _CL _CM _CN _CO _CP _CQ _CR _CS _CT _CU _CV _CW _CX _CY _CZ
             _DA _DB _DC _DD _DE _DF _DG _DH _DI _DJ _DK _DL _DM _DN _DO _DP _DQ _DR _DS _DT _DU _DV _DW _DX _DY _DZ
             _EA _EB _EC _ED _EE _EF _EG _EH _EI _EJ _EK _EL _EM _EN _EO _EP _EQ _ER _ES _ET _EU _EV _EW _EX _EY _EZ
             _FA _FB _FC _FD _FE _FF _FG _FH _FI _FJ _FK _FL _FM _FN _FO _FP _FQ _FR _FS _FT _FU _FV
bp_key = e_user

[c__plone_user_write]
blueprint = imio.transmogrifier.iadocs.csv_writer
b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('c__1_user_match_read', {}).get('filename', '_not_found_')))
filename = 0_imio_user.csv
fieldnames = uid fullname
headers = uid fullname
bp_key = p_user
store_key = uid
store_key_sort = fullname

[c__1_user_match_write]
blueprint = imio.transmogrifier.iadocs.csv_writer
b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('c__1_user_match_read', {}).get('filename', '_not_found_')))
condition = python: item.get('_bpk') == 'e_user'
filename = 0_user_match.csv
fieldnames = _eid _nom _prenom
headers = eid nom prenom p_uid p_fullname
bp_key = 0_user_match
yield = 0

# = = = = = = =  dd  = = = = = = = #

[d__need_c]
blueprint = imio.transmogrifier.iadocs.need_other
parts = c

[dm__1_contacts_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
b_condition =
filename = eContacts.csv
fieldnames = _A _eid _user_id _c_type _E _F _G _H _I _J _K _L _M _N _O _P _Q _R _S _T _U _V _W _X _Y _Z
             _AA _AB _AC _AD _AE _AF _AG _AH _AI _AJ _AK _AL _AM _AN _AO _AP _AQ _AR _AS _AT _AU _AV _AW _AX _AY _AZ
             _BA _BB _BC _BD _BE _BF _BG _BH _BI _BJ _BK _BL _BM _BN _BO _BP _BQ _BR _BS _BT _BU _BV _BW _BX _BY _BZ
             _CA _CB _CC _CD _CE _CF _CG _CH _CI _CJ _CK _CL _CM _CN _CO _CP _CQ _CR _CS _CT _CU _CV _CW _CX _CY _CZ
             _DA _DB _DC _DD _DE _DF _DG _DH _DI _DJ _DK _DL _DM _DN _DO _DP _DQ _DR _DS _DT _DU _DV _DW _DX _DY _DZ
             _EA _EB _EC _ED _EE _EF _EG _EH _EI _EJ _EK _EL _EM _EN _EO _EP _EQ _ER _ES _ET _EU _EV _EW _EX _EY _EZ
             _FA _FB _FC _FD _FE _FF _FG _FH _FI _FJ _FK _FL _FM _FN _FO _FP _FQ _FR _FS _FT _FU
bp_key = e_contacts_sender

[dm__1_contacts_userid_only]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'dm') and item.get('_bpk') == u'e_contacts_sender'
condition2 = python: item.get('_user_id') is not None

[dm__1_contacts_store]
blueprint = imio.transmogrifier.iadocs.store_in_data
condition = python: item.get('_bpk') == u'e_contacts_sender'
bp_key = e_contacts_sender
store_key = _eid
fieldnames = _user_id
yield = 0

[d__1_mail_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
b_condition =
filename = eCourriers.csv
fieldnames = _A _eid _C _D _E _F _G _H _sender_id _sender _service _L _M _etype _O _P _Q _R _S _T _U _V _W _X _Y _Z
             _AA _AB _AC _AD _AE _AF _AG _AH _AI _AJ _AK _AL _AM _AN _AO _AP _AQ _AR _AS _AT _AU _AV _AW _AX _AY _AZ
             _BA _BB _BC _BD _BE _BF _BG _BH _BI _BJ _BK _BL _BM
bp_key = e_mail_sender

[d__1_S_only]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'd') and item.get('_bpk') == u'e_mail_sender'
condition2 = python: item.get('_etype') == 'S'

[d__om_sender_creation]
blueprint = imio.transmogrifier.iadocs.d_om_sender_creation
condition = python: item.get('_bpk') == u'e_mail_sender'

# = = = = = = =  ee  = = = = = = = #

[e__category_full_match_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
b_condition = python: modules['os'].path.exists(filename)
filename = 2_category_match.csv
fieldnames = _eid _ecode _etitle _eactive _pcode _puid _ptitle _pactive
bp_key = e_category_full_match

[e__category_full_match_store]
blueprint = imio.transmogrifier.iadocs.store_in_data
condition = python: item.get('_bpk') == u'e_category_full_match'
bp_key = e_category_full_match
store_key = _eid
fieldnames = _ecode _etitle _pcode _puid
yield = 0

[e__category_match_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
b_condition = python: modules['os'].path.exists(filename) and not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('e__category_full_match_read', {}).get('filename', '_not_found_')))
filename = 1_category_match.csv
fieldnames = _eid _ecode _etitle _eactive _pcode _puid _ptitle _pactive
bp_key = e_category_match

[e__1_category_match_check]
blueprint = imio.transmogrifier.iadocs.common_input_checks
bp_key = e_category_match
condition = python: item.get('_bpk') == u'e_category_match'
strip_chars = _ecode .
booleans = _eactive

[e__1_mail_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('e__category_match_read', {}).get('filename', '_not_found_')))
filename = eCourriers.csv
fieldnames = _A _eid _C _D _E _F _G _H _I _J _K _L _M _N _O _category_id _Q _R _S _T _U _V _W _X _Y _Z
             _AA _AB _AC _AD _AE _AF _AG _AH _AI _AJ _AK _AL _AM _AN _AO _AP _AQ _AR _AS _AT _AU _AV _AW _AX _AY _AZ
             _BA _BB _BC _BD _BE _BF _BG _BH _BI _BJ _BK _BL _BM _BN _BO _BP _BQ
bp_key = e_mail_category

[e__1_folder_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('e__category_match_read', {}).get('filename', '_not_found_')))
filename = eClassementDossiers.csv
fieldnames = _A _eid _C _D _E _F _G _H _I _category_id _K _L _M _N _O _P _Q _R _S _T _U _V _W _X _Y _Z _AA _AB _AC _AD _AE _AF _AG _AH _AI _AJ _AK _AL _AM _AN _AO
bp_key = e_folder_category

[e__1_category_reject]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'e') and item.get('_bpk') in (u'e_mail_category', u'e_folder_category')
condition2 = python: item.get('_category_id') not in (None, u'0')

[e__1_store_used_category]
blueprint = imio.transmogrifier.iadocs.store_in_data
condition = python: item.get('_bpk') in (u'e_mail_category', u'e_folder_category')
bp_key = e_used_category
store_key = _category_id
store_subkey = _bpk
fieldnames = _eid
yield = 0

[e__1_category_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
b_condition = python: modules['os'].path.exists(filename)
              and not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('e__category_match_read', {}).get('filename', '_not_found_')))
filename = eClassement.csv
fieldnames = _A _eid _C _ecode _etitle _eactive _G _H _I _J _K _L
bp_key = e_category

[e__1_category_code_modify]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_category' and item['_ecode'].startswith('1.824.508/')
key = string:_code
value = python:item['_ecode'].replace('/', '.')

[e__1_category_check]
blueprint = imio.transmogrifier.iadocs.common_input_checks
bp_key = e_category
condition = python: item.get('_bpk') == u'e_category'
strip_chars = _ecode .
booleans = _eactive

[e__category_store]
blueprint = imio.transmogrifier.iadocs.store_in_data
condition = python: item.get('_bpk') == u'e_category'
bp_key = e_category
store_key = _ecode
fieldnames = _eid _etitle _eactive
yield = 0

[e__category_load]
blueprint = imio.transmogrifier.iadocs.read_from_data
bp_key = e_category
store_key = _ecode
fieldnames = _eid _etitle _eactive

[e__category_used_only]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'e') and item.get('_bpk') == u'e_category'
condition2 = python: item.get('_eid') in storage['data'].get('e_used_category', [])

[e__category_not_in_plone]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'e') and item.get('_bpk') == u'e_category'
condition2 = python: item['_ecode'] not in storage['data'].get('p_category', [])

[e__plone_category_write]
blueprint = imio.transmogrifier.iadocs.csv_writer
b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('e__category_match_read', {}).get('filename', '_not_found_')))
filename = 0_imio_category.csv
fieldnames = _pcode uid title enabled
headers = pcode puid ptitle pactive
bp_key = p_category
store_key = _pcode
store_key_sort =
yield = 1

[e__category_matched_add]
blueprint = imio.transmogrifier.iadocs.add_data_in_item
b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('e__category_match_read', {}).get('filename', '_not_found_')))
condition = python: item.get('_bpk') == u'e_category'
bp_key = e_category_matched_add
related_storage = p_category
store_key = _ecode
store_subkey =
fieldnames = title uid enabled
prefix = _p

[e__category_match_write]
blueprint = imio.transmogrifier.iadocs.csv_writer
b_condition = python: len(transmogrifier.storage['data']['p_category']) != 0 and
              not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('e__category_match_read', {}).get('filename', '_not_found_')))
condition = python: item.get('_bpk') == 'e_category'
filename = 0_category_match.csv
fieldnames = _eid _ecode _etitle _eactive _p_ecode _puid _ptitle _penabled
headers = eid ecode etitle eactive pcode puid ptitle pactive
bp_key = 0_category_match
yield = 0

[e__category_update]
blueprint = imio.transmogrifier.iadocs.e_category_update
b_condition = python: modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('e__category_match_read', {}).get('filename', '_not_found_')))
condition = python: item.get('_bpk') == 'e_category_match'
bp_key = e_category_update

[e__category_create]
blueprint = imio.transmogrifier.iadocs.e_category_update
b_condition = python: len(transmogrifier.storage['data']['p_category']) == 0
condition = python: item.get('_bpk') == 'e_category'
bp_key = e_category_create

[e__category_full_match_write]
blueprint = imio.transmogrifier.iadocs.csv_writer
# b_condition = python: storage['commit'] and not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('e__category_full_match_read', {}).get('filename', '_not_found_')))
condition = python: item.get('_bpk') == 'e_category_match'
filename = 2_category_match.csv
fieldnames = _eid _ecode _etitle _eactive _pcode _puid _ptitle _pactive
headers = eid ecode etitle eactive pcode puid ptitle pactive
bp_key = 2_category_match
yield = 0

# = = = = = = =  ff  = = = = = = = #

[fs__1_folder_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
#b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('e__category_match_read', {}).get('filename', '_not_found_')))
filename = eClassementDossiers.csv
fieldnames = _A _eid _title _archive _archive_date _localisation _comment1 _service_id _I _category_id _parent1 _parent2 _M _N _O _P _Q _R _S _T _comment2 _V _W _X _Y _Z _AA _AB _AC _AD _AE _AF _AG _AH _AI
bp_key = e_folder

[fs__1_folder_check]
blueprint = imio.transmogrifier.iadocs.common_input_checks
bp_key = e_folder
condition = python: item.get('_bpk') == u'e_folder'
hyphen_newline = _title _comment1 _comment2
booleans = _archive

[f__folder_matched_uid_add]
blueprint = imio.transmogrifier.iadocs.add_data_in_item
#b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('e__category_match_read', {}).get('filename', '_not_found_')))
condition = python: item.get('_bpk') == u'e_folder'
bp_key = f_folder_matched_uid_add
related_storage = p_irn_to_folder
store_key = _eid
store_subkey =
fieldnames = uid
prefix = _pf
marker = eid_present

[f__folder_matched_folder_info_add]
blueprint = imio.transmogrifier.iadocs.add_data_in_item
#b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('e__category_match_read', {}).get('filename', '_not_found_')))
condition = python: item.get('_bpk') == u'e_folder'
bp_key = f_folder_matched_folder_info_add
related_storage = p_folder_uid
store_key = _pfuid
store_subkey =
fieldnames = full_title parent
prefix = _p
add_store_keys = 0

[f__folder_service_uid_add]
blueprint = imio.transmogrifier.iadocs.add_data_in_item
#b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('e__category_match_read', {}).get('filename', '_not_found_')))
condition = python: item.get('_bpk') == u'e_folder'
bp_key = f_folder_service_uid_add
related_storage = p_eid_to_orgs
store_key = _service_id
store_subkey =
fieldnames = uid
prefix = _ps_

[f__folder_service_name_add]
blueprint = imio.transmogrifier.iadocs.add_data_in_item
#b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('e__category_match_read', {}).get('filename', '_not_found_')))
condition = python: item.get('_bpk') == u'e_folder'
bp_key = f_folder_service_name_add
related_storage = p_orgs_all
store_key = _ps_uid
store_subkey =
fieldnames = ft
prefix = _ps
add_store_keys = 0

[f__folder_match_write]
blueprint = imio.transmogrifier.iadocs.csv_writer
#b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('e__category_match_read', {}).get('filename', '_not_found_')))
condition = python: item.get('_bpk') == 'e_folder'
filename = 0_folder_match.csv
fieldnames = _eid _title _archive _parent2 _psft _pfuid _pfull_title _pparent _mar_ker
headers = eid etitle earchive eparent eservice puid ptitle pparent origin
bp_key = 0_folder_match
yield = 0

[f__plone_folder_write]
blueprint = imio.transmogrifier.iadocs.csv_writer
#b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('e__category_match_read', {}).get('filename', '_not_found_')))
filename = 0_imio_folder.csv
fieldnames = _puid title parent irn peid
headers = uid title parent_uid reference_nb eid
bp_key = p_folder_uid
store_key = _puid
store_key_sort =
yield = 1

# = = = = = = =  hh  = = = = = = = #

[h__contact_type_match_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
b_condition = python: modules['os'].path.exists(filename)
filename = 1_contact_type_match.csv
fieldnames = _eid _etitle _pid _ptitle
bp_key = e_contact_type_match

[h__contact_type_match_store]
blueprint = imio.transmogrifier.iadocs.store_in_data
condition = python: item.get('_bpk') == u'e_contact_type_match'
bp_key = e_contact_type_match
store_key = _eid
fieldnames = _etitle _pid _ptitle
yield = 1

[h__1_contacts_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('h__contact_type_match_read', {}).get('filename', '_not_found_')))
filename = eContacts.csv
fieldnames = ${dm__1_contacts_read:fieldnames}
bp_key = e_contacts

[h__1_used_contact_type_store]
blueprint = imio.transmogrifier.iadocs.store_in_data
condition = python: item.get('_bpk') == u'e_contacts'
bp_key = e_used_contact_type
store_key = _c_type
fieldnames = _eid
yield = 0

[h__1_contact_type_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('h__contact_type_match_read', {}).get('filename', '_not_found_')))
filename = eContactsType.csv
fieldnames = _A _eid _etitle _D _E _F _G _H _I _J _K _L _M _N _O _P _Q _R _S _T
bp_key = e_contact_type

[h__contact_type_used_only]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'h') and item.get('_bpk') == u'e_contact_type'
condition2 = python: item.get('_eid') in storage['data'].get('e_used_contact_type', [])

[h__plone_contact_type_write]
blueprint = imio.transmogrifier.iadocs.csv_writer
b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('h__contact_type_match_read', {}).get('filename', '_not_found_')))
filename = 0_imio_contact_type.csv
fieldnames = token name
headers = pid ptitle
bp_key = p_dir_org_types
store_key = token
store_key_sort = __no_sort__

[h__contact_type_match_write]
blueprint = imio.transmogrifier.iadocs.csv_writer
b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('h__contact_type_match_read', {}).get('filename', '_not_found_')))
condition = python: item.get('_bpk') == 'e_contact_type'
filename = 0_contact_type_match.csv
fieldnames = _eid _etitle
headers = eid etitle pid ptitle
bp_key = 0_contact_type_match
yield = 0

[h__contact_type_update]
blueprint = imio.transmogrifier.iadocs.h_contact_type_update
condition = python: item['_bpk'] == u'e_contact_type_match'
clean_unused = 1

# = = = = = = =  ii  = = = = = = = #

[i__need]
blueprint = imio.transmogrifier.iadocs.need_other
parts = h

[ilpq__1_contacts_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
b_condition =
filename = eContacts.csv
fieldnames = _A _eid _user_id _ctyp _E _lname _fname _ptitle _street _pc _city _L _phone1 _phone2 _phone3 _P _Q _R _email1 _email2 _email3 _V _W _X _function _Z
             _AA _AB _AC _AD _AE _AF _AG _e_nb _AI _AJ _AK _AL _AM _AN _cell1 _cell2 _cell3 _web _org _name2 _AU _AV _AW _AX _deactivate _AZ
             _BA _parent_id _BC _BD _BE _BF _BG _BH _BI _BJ _BK _BL _BM _BN _BO _BP _BQ _BR _BS _BT _BU _BV _BW _BX _BY _BZ
             _CA _CB _CC _CD _CE _CF _CG _CH _CI _CJ _CK _CL _CM _CN _CO _CP _CQ _CR _CS _CT _CU _CV _CW _CX _CY _CZ
             _DA _DB _DC _DD _DE _DF _DG _DH _DI _DJ _DK _DL _DM _DN _DO _DP _DQ _DR _DS _DT _DU _DV _DW _DX _DY _DZ
             _EA _EB _EC _ED _EE _EF _EG _EH _EI _EJ _EK _EL _EM _EN _EO _EP _EQ _ER _ES _ET _EU _EV _EW _EX _addr_id _EZ
             _FA _FB _FC _FD _FE _FF _FG _FH _FI _FJ _FK _FL _FM _FN _FO _FP _FQ _FR _FS _FT _FU
bp_key = e_contact

[i__pickle_c_w]
blueprint = imio.transmogrifier.iadocs.pickle_data
filename = 2_e_contact.pkl
store_key = e_contact_path
d_condition = python:storage['commit'] is True

[ilpq__1_contacts_check]
blueprint = imio.transmogrifier.iadocs.common_input_checks
bp_key = e_contact
condition = python: item.get('_bpk') == u'e_contact'
hyphen_newline = _lname _fname _street _city
invalids = _lname 0 -fname 0 _street ",|0, 0|0, 23" _pc 0 _city 0 _org 0
booleans = _org _deactivate
raise_on_error = ${config:raise_on_error}

[i__type_inserter]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'i') and item.get('_bpk') == u'e_contact'
key = string:_type
value = python:(item['_org'] or item['_fname'] is None) and u'organization' or u'person'

[i__1_parent_relation_store]
blueprint = imio.transmogrifier.iadocs.store_in_data
condition = python: item.get('_bpk') == u'e_contact' and item['_parent_id'] and item['_type'] == u'organization'
bp_key = e_parent_relation
store_key = _eid
fieldnames = _parent_id
yield = 1

[ilpq__1_contacts_store]
blueprint = imio.transmogrifier.iadocs.store_in_data
condition = python: item.get('_bpk') == u'e_contact'
bp_key = e_contact
store_key = _eid
fieldnames = _ln _type _user_id _ctyp _lname _fname _ptitle _street _pc _city _phone2 _phone2 _phone3 _email1 _email2 _email3
             _function _e_nb _cell1 _cell2 _cell3 _web _org _name2 _parent_id _addr_id
yield = 0

[i__dependency_sorter]
blueprint = imio.transmogrifier.iadocs.dependency_sorter
# condition = python: item['_type'] == u'organization'
condition =
bp_key = e_contact
store_key = _eid
parent_relation = e_parent_relation

[i__1_contacts_load]
blueprint = imio.transmogrifier.iadocs.read_from_data
bp_key = e_contact
store_key = _eid
fieldnames =
sort_value = python:(data[k]['_level'], data[k]['_ln'])

[i__1_id_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_contact'
key = string:_id
value = python:item['_eid']

[i__1_parent_insert]
blueprint = imio.transmogrifier.iadocs.parent_path_insert
bp_key = e_contact_path

[i__1_path_insert]
blueprint = imio.transmogrifier.iadocs.path_insert
condition = python: item.get('_bpk') == u'e_contact'
bp_key = e_contact_path
id_keys = _eid

# = = = = = = =  ll  = = = = = = = #

[l__need]
blueprint = imio.transmogrifier.iadocs.need_other
parts = abce

[l__1_mail_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
#b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('b__mailtype_match_read', {}).get('filename', '_not_found_')))
# filename = eCourriers_E_test.csv
filename = eCourriers.csv
fieldnames = _A _eid _C reception_date original_mail_date external_reference_no due_date _nature_id _sender_id _sender _service_id title _remark _etype _confidential _category_id
             _Q _R _S _T _U _to_del _W _source _source_id _Z
             creation_date _AB _AC _AD _AE _AF _AG _AH _AI _meeting_link _meetingitem_link _AL _AM _AN _AO _AP _AQ _AR _AS _AT _AU _AV _AW _AX _AY _AZ
             _BA _BB _BC _BD _BE _BF _BG _BH _BI _BJ _BK _BL _BM
bp_key = e_mail_i

[l__pickle_i_w]
blueprint = imio.transmogrifier.iadocs.pickle_data
filename = 2_e_mail_i.pkl
store_key = e_mail_i
d_condition = python:storage['commit'] is True and 'l__to_correct_only' not in transmogrifier['transmogrifier']['pipeline'].split('\n')

[l__1_E_only]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'l') and item.get('_bpk') == u'e_mail_i'
condition2 = python: item.get('_etype') == 'E'

[l__batched]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'l') and item.get('_bpk') == u'e_mail_i'
condition2 = python:not storage['batch_nb'] and True or (item['_eid'] not in storage['data']['e_mail_i'] and storage.get('count', {}).get('l__count', {}).get('e_mail_i', {}).get('c', 0) < storage['batch_nb'])

[l__count]
blueprint = imio.transmogrifier.iadocs.count
group_key = _bpk
condition = python: item.get('_bpk') == u'e_mail_i'

[l__1_mail_check]
blueprint = imio.transmogrifier.iadocs.common_input_checks
bp_key = e_mail_i
condition = python: item.get('_bpk') == u'e_mail_i'
clean_value = _remark python:u'\n' " " "python:[r'^[""\']+$']" python:u'\r\n'
hyphen_newline = external_reference_no
invalids = reception_date 0 original_mail_date 0 due_date 0
split_text = title 300 description 0 python:'\n' python:'\r\n' "SUITE TITRE: "
booleans = _confidential _meetingitem_link
dates = reception_date %Y%m%d 0 original_mail_date %Y%m%d 1 due_date %Y%m%d 1 creation_date %Y%m%d 0

[l__modification_date_insert]
blueprint = collective.transmogrifier.sections.manipulator
condition = python: item.get('_bpk') == u'e_mail_i'
keys = creation_date
destination = string:modification_date

[l__reception_date_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_i' and item['reception_date'] is None
key = string:reception_date
value = python:item['creation_date']

[l__original_mail_date_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_i' and item['original_mail_date'] is None
key = string:original_mail_date
value = python:item['creation_date'].date()

[l__1_internal_number_insert]
blueprint = collective.transmogrifier.sections.manipulator
condition = python: item.get('_bpk') == u'e_mail_i'
keys = _eid
destination = string:internal_number

[l__1_comblain_service_id_correct]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_i' and item['_category_id'] not in (None, u'0') and item['_service_id'] != u'333'
            and int(item['_category_id']) >= 48235 and int(item['_category_id']) <= 48271
key = string:_service_id
value = python:u'333'

[l__treating_groups_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_i'
key = string:treating_groups
value = python:storage['data']['e_service_match'][item['_service_id']]['uid']

[l__1_recipient_groups_set]
blueprint = imio.transmogrifier.iadocs.l_1_recipient_groups_set
condition = python: item.get('_bpk') == u'e_mail_i'
global_recipient_service = Reprise de données
global_recipient_tg_exceptions = 333 Personnel 336 DirecteurFinancier 339 DirecteurGénéral 386 SIPPT 387 RégimeDisciplinaire

[l__1_category_id_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_i' and item['_category_id'] not in (None, u'0')
key = string:classification_categories
value = python:[storage['data']['e_category_full_match'][item['_category_id']]['_puid']]
error = python:u"category '{}' not found for eid '{}'".format(item['_category_id'], item['_eid'])

[l__default_contact_set]
blueprint = imio.transmogrifier.iadocs.default_contact_set
fieldname = sender
is_list = 1
condition = python: item.get('_bpk') == u'e_mail_i'

[l__1_sender_as_text_set]
blueprint = imio.transmogrifier.iadocs.l_1_sender_as_text_set
condition = python: item.get('_bpk') == u'e_mail_i'

[l__mail_type_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_i' and item['_nature_id']
key = string:mail_type
value = python:storage['data']['e_mailtype_match'][item['_nature_id']]['E']['_key']

[l__1_nature_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_i' and item['_nature_id']
key = string:data_transfer
value = python:u'NATURE: {}.'.format(storage['data']['e_mailtype_match'][item['_nature_id']]['E']['_etitle'])
separator = python:u'\r\n'

[l__mail_type2_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_i' and 'mail_type' not in item
key = string:mail_type
value = python: item['_source_id'] and storage['data']['e_mailtype_match'][item['_source_id']]['E']['_key'] or u'${config:default_i_mail_type}'

[l__1_source_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_i' and item['_source_id']
key = string:data_transfer
value = python:u'SOURCE: {}.'.format(storage['data']['e_mailtype_match'][item['_source_id']]['E']['_etitle'])
separator = python:u'\r\n'

[l__1_meetingitem_link_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_i' and item['_meetingitem_link']
key = string:data_transfer
value = python:u'LIEN AVEC UN POINT DELIB.'
separator = python:u'\r\n'

[l__1_confidential_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_i' and item['_confidential']
key = string:data_transfer
value = python:u'COURRIER CONFIDENTIEL.'
separator = python:u'\r\n'

[l__1_remark_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_i' and item.get('_remark')
key = string:description
value = python: u'REMARQUES: {}.'.format(item['_remark'])
separator = python:u'\r\n'

[l__1_id_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_i'
key = string:_id
value = python:item['_eid']

[l__1_type_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_i'
key = string:_type
value = python:(item['_source_id'] == u'295' or item['_nature_id'] == u'180') and 'dmsincoming_email' or 'dmsincomingmail'

[l__1_parent_insert]
blueprint = imio.transmogrifier.iadocs.parent_path_insert

[l__1_path_insert]
blueprint = imio.transmogrifier.iadocs.path_insert
condition = python: item.get('_bpk') == u'e_mail_i'
bp_key = e_mail_i
id_keys = _eid

[l__to_correct_only]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'l') and item.get('_bpk') == u'e_mail_i'
condition2 = python: obj is None and True or (obj.original_mail_date is None or obj.original_mail_date > modules['datetime'].date(2023,1,1) or
             obj.reception_date is None or obj.reception_date > modules['datetime'].datetime(2023,1,1))
get_obj = 1

[l__filter_item]
blueprint = imio.transmogrifier.iadocs.filter_item
condition = python: item.get('_bpk') == u'e_mail_i'
kept_keys = modification_date original_mail_date reception_date

# = = = = = = =  mm  = = = = = = = #

[m__need]
blueprint = imio.transmogrifier.iadocs.need_other
parts = ac

[m__user_service_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
b_condition = python: modules['os'].path.exists(filename)
# filename is relative to csvpath
filename = eUsersServices.csv
fieldnames = _A _euserid _eserviceid _D _E _F _G _H _I _J _K _L _M _N _O _P _Q _R _S _T _U _V _W _X _Y _Z
             _AA _AB _AC _AD _AE _AF _AG _AH _AI _AJ _AK _AL _AM _AN _AO _AP _AQ _AR _AS _AT _AU _AV _AW _AX _AY _AZ _BA _BB _BC
bp_key = e_user_service

[m__user_service_store]
blueprint = imio.transmogrifier.iadocs.store_in_data
condition = python: item.get('_bpk') == u'e_user_service'
bp_key = e_user_service
store_key = _euserid
store_subkey = _eserviceid
fieldnames =
yield = 0

[mt__pickle_i_r]
blueprint = imio.transmogrifier.iadocs.pickle_data
filename = 2_e_mail_i.pkl
store_key = e_mail_i
d_condition = python:False

[m__1_mail_recipient_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
#b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('b__mailtype_match_read', {}).get('filename', '_not_found_')))
filename = eCourriersDestinataires.csv
fieldnames = _A _eid _mail_id _contact_id _action _due_date _trm_date _H _trm_user_id _message _response _L _trt_date _N _O _P _principal _comment _S _T _U _V
bp_key = e_mail_recip_i

[m__1_already_only]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'm') and item.get('_bpk') == u'e_mail_recip_i'
condition2 = python: item['_mail_id'] in storage['data']['e_mail_i']

[m__1_mail_recipient_check]
blueprint = imio.transmogrifier.iadocs.common_input_checks
bp_key = e_mail_recip_i
condition = python: item.get('_bpk') == u'e_mail_recip_i'
hyphen_newline = _action _message _response _comment
invalids = _due_date 0
booleans = _principal
dates = _due_date %Y%m%d 1 _trm_date %Y%m%d 1

[m__1_principal_only]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'm') and item.get('_bpk') == u'e_mail_recip_i'
condition2 = python: item['_principal']

[m__count]
blueprint = imio.transmogrifier.iadocs.count
group_key = _bpk
condition = python: item.get('_bpk') == u'e_mail_recip_i'

[m__1_assigned_user]
blueprint = imio.transmogrifier.iadocs.m_1_assigned_user
condition = python: item.get('_bpk') == u'e_mail_recip_i'
store_key = e_mail_i

# = = = = = = =  pp  = = = = = = = #

[p__need]
blueprint = imio.transmogrifier.iadocs.need_other
parts = abce

[p__1_mail_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
#b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('b__mailtype_match_read', {}).get('filename', '_not_found_')))
# filename = eCourriers_S_test.csv
filename = eCourriers.csv
fieldnames = _A _eid _C outgoing_date mail_date external_reference_no due_date _nature_id _sender_id _sender _service_id title _remark _etype _confidential _category_id
             _Q _R _S _T _U _to_del _W _source _source_id _Z
             creation_date _AB _AC _AD _AE _AF _AG _AH _AI _meeting_link _meetingitem_link _AL _AM _AN _AO _AP _AQ _AR _AS _AT _AU _AV _AW _AX _AY _AZ
             _BA _BB _BC _BD _BE _BF _BG _BH _BI _BJ _BK _BL _BM
bp_key = e_mail_o

[p__pickle_o_w]
blueprint = imio.transmogrifier.iadocs.pickle_data
filename = 2_e_mail_o.pkl
store_key = e_mail_o
d_condition = python:storage['commit'] is True and 'p__to_correct_only' not in transmogrifier['transmogrifier']['pipeline'].split('\n')

[p__1_S_only]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'p') and item.get('_bpk') == u'e_mail_o'
condition2 = python: item.get('_etype') == 'S' and item.get('creation_date') != '0'

[p__batched]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'p') and item.get('_bpk') == u'e_mail_o'
condition2 = python:not storage['batch_nb'] and True or (item['_eid'] not in storage['data']['e_mail_o'] and storage.get('count', {}).get('p__count', {}).get('e_mail_o', {}).get('c', 0) < storage['batch_nb'])

[p__count]
blueprint = imio.transmogrifier.iadocs.count
group_key = _bpk
condition = python: item.get('_bpk') == u'e_mail_o'

[p__1_mail_check]
blueprint = imio.transmogrifier.iadocs.common_input_checks
bp_key = e_mail_o
condition = python: item.get('_bpk') == u'e_mail_o'
hyphen_newline = external_reference_no
invalids = outgoing_date 0 mail_date 0 due_date 0
clean_value = title python:u'\n' " " "python:[r'^[""\' ]+$']" python:u'\n' _remark python:u'\n' " " "python:[r'^[""\' ]+$']" python:u'\r\n'
split_text = title 300 description 0 python:'\n' python:'\r\n' "Suite titre: "
booleans = _confidential _meetingitem_link
dates = outgoing_date %Y%m%d 0 mail_date %Y%m%d 1 due_date %Y%m%d 1 creation_date %Y%m%d 0

[p__modification_date_insert]
blueprint = collective.transmogrifier.sections.manipulator
condition = python: item.get('_bpk') == u'e_mail_o'
keys = creation_date
destination = string:modification_date

[p__outgoing_date_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_o' and item['outgoing_date'] is None
key = string:outgoing_date
value = python:item['creation_date']

[p__mail_date_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_o' and item['mail_date'] is None
key = string:mail_date
value = python:item['creation_date'].date()

[p__1_internal_number_insert]
blueprint = collective.transmogrifier.sections.manipulator
condition = python: item.get('_bpk') == u'e_mail_o'
keys = _eid
destination = string:internal_number

[p__1_comblain_service_id_correct]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_o' and item['_category_id'] not in (None, u'0') and item['_service_id'] != u'333'
            and int(item['_category_id']) >= 48235 and int(item['_category_id']) <= 48271
key = string:_service_id
value = python:u'333'

[p__treating_groups_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_o'
key = string:treating_groups
value = python:storage['data']['e_service_match'][item['_service_id']]['uid']

[p__1_recipient_groups_set]
blueprint = imio.transmogrifier.iadocs.l_1_recipient_groups_set
condition = python: item.get('_bpk') == u'e_mail_o'
global_recipient_service = Reprise de données
global_recipient_tg_exceptions = 333 Personnel 336 DirecteurFinancier 339 DirecteurGénéral 386 SIPPT 387 RégimeDisciplinaire

[p__1_sender_set]
blueprint = imio.transmogrifier.iadocs.p_om_sender_set
condition = python: item.get('_bpk') == u'e_mail_o'

[p__default_contact_set]
blueprint = imio.transmogrifier.iadocs.default_contact_set
fieldname = recipients
is_list = 1
condition = python: item.get('_bpk') == u'e_mail_o'

[p__1_category_id_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_o' and item['_category_id'] not in (None, u'0')
key = string:classification_categories
value = python:[storage['data']['e_category_full_match'][item['_category_id']]['_puid']]
error = python:u"category '{}' not found for eid '{}'".format(item['_category_id'], item['_eid'])

[p__mail_type_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_o'
key = string:mail_type
value = python:item['_nature_id'] and storage['data']['e_mailtype_match'][item['_nature_id']]['S']['_key'] or u'${config:default_o_mail_type}'

[p__1_nature_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_o' and item['_nature_id']
key = string:data_transfer
value = python:u'NATURE: {}.'.format(storage['data']['e_mailtype_match'][item['_nature_id']]['S']['_etitle'])
separator = python:u'\r\n'

[p__send_modes_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_o'
key = string:send_modes
value = python: item['_source_id'] and storage['data']['e_mailtype_match'][item['_source_id']]['S']['_key'] or u'${config:default_o_send_mode}'

[p__1_source_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_o' and item['_source_id']
key = string:data_transfer
value = python:u'SOURCE: {}.'.format(storage['data']['e_mailtype_match'][item['_source_id']]['S']['_etitle'])
separator = python:u'\r\n'

[p__1_meetingitem_link_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_o' and item['_meetingitem_link']
key = string:data_transfer
value = python:u'LIEN AVEC UN POINT DELIB.'
separator = python:u'\r\n'

[p__1_confidential_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_o' and item['_confidential']
key = string:data_transfer
value = python:u'COURRIER CONFIDENTIEL.'
separator = python:u'\r\n'

[p__1_remark_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_o' and item.get('_remark')
key = string:description
value = python:u'REMARQUES: {}.'.format(item['_remark'])
separator = python:u'\r\n'

[p__1_id_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_o'
key = string:_id
value = python:item['_eid']

[p__1_type_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: item.get('_bpk') == u'e_mail_o'
key = string:_type
value = string:dmsoutgoingmail

[p__1_parent_insert]
blueprint = imio.transmogrifier.iadocs.parent_path_insert

[p__1_path_insert]
blueprint = imio.transmogrifier.iadocs.path_insert
condition = python: item.get('_bpk') == u'e_mail_o'
bp_key = e_mail_o
id_keys = _eid

[p__to_correct_only]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'p') and item.get('_bpk') == u'e_mail_o'
condition2 = python: obj is None and True or (obj.mail_date is None or obj.mail_date > modules['datetime'].date(2023,1,1))
get_obj = 1

[p__filter_item]
blueprint = imio.transmogrifier.iadocs.filter_item
condition = python: item.get('_bpk') == u'e_mail_o'
kept_keys = modification_date mail_date

# = = = = = = =  qq  = = = = = = = #

[q__need]
blueprint = imio.transmogrifier.iadocs.need_other
parts =

[qu__pickle_o_r]
blueprint = imio.transmogrifier.iadocs.pickle_data
filename = 2_e_mail_o.pkl
store_key = e_mail_o
d_condition = python:False

[q__1_mail_recipient_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
#b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('b__mailtype_match_read', {}).get('filename', '_not_found_')))
# filename = eCourriersDestinataires_test.csv
filename = eCourriersDestinataires.csv
fieldnames = _A _eid _mail_id _contact_id _action _due_date _trm_date _H _trm_user_id _message _response _L _trt_date _N _O _P _principal _comment _S _T _U _V
bp_key = e_mail_recip_o

[q__1_already_only]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'q') and item.get('_bpk') == u'e_mail_recip_o'
condition2 = python: item['_mail_id'] in storage['data']['e_mail_o']

[q__1_mail_recipient_check]
blueprint = imio.transmogrifier.iadocs.common_input_checks
bp_key = e_mail_recip_o
condition = python: item.get('_bpk') == u'e_mail_recip_o'
hyphen_newline = _action _message _response _comment
invalids = _due_date 0
booleans = _principal
dates = _due_date %Y%m%d 1 _trm_date %Y%m%d 1

[q__1_principal_only]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'q') and item.get('_bpk') == u'e_mail_recip_o'
condition2 = python: item['_principal']

[q__count]
blueprint = imio.transmogrifier.iadocs.count
group_key = _bpk
condition = python: item.get('_bpk') == u'e_mail_recip_o'

[q__1_recipients]
blueprint = imio.transmogrifier.iadocs.q_1_recipients_as_text_update
condition = python: item.get('_bpk') == u'e_mail_recip_o'
store_key = e_mail_o

# = = = = = = =  ss  = = = = = = = #

[s__need]
blueprint = imio.transmogrifier.iadocs.need_other
parts =

[sx__pickle_i_r]
blueprint = imio.transmogrifier.iadocs.pickle_data
filename = 2_e_mail_i.pkl
store_key = e_mail
d_condition = python:False

[sx__pickle_o_r]
blueprint = imio.transmogrifier.iadocs.pickle_data
filename = 2_e_mail_o.pkl
store_key = e_mail
d_condition = python:False
update = 1

[s__1_folder_store]
blueprint = imio.transmogrifier.iadocs.store_in_data
condition = python: item.get('_bpk') == u'e_folder'
bp_key = e_folder
store_key = _eid
fieldnames = _title
yield = 0

[s__pickle_mail_folder_w]
blueprint = imio.transmogrifier.iadocs.pickle_data
filename = 2_e_mail_folder.pkl
store_key = classification_folders
d_condition = python:storage['commit'] is True

[s__1_mail_folder_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
#b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('b__mailtype_match_read', {}).get('filename', '_not_found_')))
filename = eCourriersDossiers.csv
fieldnames = _A _eid _folder_id _principal
bp_key = e_mail_folder

[s__1_already_only]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 's') and item.get('_bpk') == u'e_mail_folder'
condition2 = python: item['_eid'] in storage['data']['e_mail']

[s__batched]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 's') and item.get('_bpk') == u'e_mail_folder'
condition2 = python:not storage['batch_nb'] and True or ((item['_eid'] not in storage['data']['classification_folders'] or item['_folder_id'] not in storage['data']['classification_folders'][item['_eid']])
             and storage.get('count', {}).get('s__count', {}).get('classification_folders', {}).get('c', 0) < storage['batch_nb'])

[s__1_classification_folders_update]
blueprint = imio.transmogrifier.iadocs.s_1_classification_folders_update
condition = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 's') and item.get('_bpk') == u'e_mail_folder'
store_key = e_mail

[s__count]
blueprint = imio.transmogrifier.iadocs.count
group_key = _bpk
condition = python: item.get('_bpk') == u'classification_folders'

[s__1_batch_store]
blueprint = imio.transmogrifier.iadocs.store_in_data
condition = python: item.get('_bpk') == u'classification_folders'
bp_key = classification_folders
store_key = _eid
store_subkey = _folder_id
fieldnames = _eid
yield = 1

# = = = = = = =  tt  = = = = = = = #

[t__need]
blueprint = imio.transmogrifier.iadocs.need_other
parts =

[t__pickle_file_i_w]
blueprint = imio.transmogrifier.iadocs.pickle_data
filename = 2_e_mail_file_i.pkl
store_key = e_dmsfile_i
d_condition = python:storage['commit'] is True

[t__1_mail_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
#b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('b__mailtype_match_read', {}).get('filename', '_not_found_')))
#filename = eCourriers_E_test.csv
filename = eCourriers.csv
fieldnames = _A _eid _C _D _E _F _G _H _I _J _K _L _M _etype _O _P _Q _R _S _T _U _to_del _W _X _Y _Z
             _AA _AB _AC _AD _AE _AF _AG _AH _AI _AJ _AK _AL _AM _AN _AO _AP _AQ _AR _AS _AT _AU _AV _AW _AX _AY _AZ
             _BA _BB _BC _BD _BE _BF _BG _BH _BI _BJ _BK _BL _BM
bp_key = e_mail

[t__1_E_only]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 't') and item.get('_bpk') == u'e_mail'
condition2 = python: item.get('_etype') in ('E', 'S') and str(item['_to_del']) != '1'
# condition2 = python: item.get('_etype') in ('E',) and str(item['_to_del']) != '1'

[t__1_store_mail]
blueprint = imio.transmogrifier.iadocs.store_in_data
condition = python: item.get('_bpk') == u'e_mail'
bp_key = e_mail
store_key = _eid
fieldnames = _etype
yield = 0

[tu__1_dmsfile_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
#b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('b__mailtype_match_read', {}).get('filename', '_not_found_')))
# filename = eCourriersFichiers_test.csv
filename = eCourriersFichiers.csv
fieldnames = _A _eid _mail_id _filename _ext _fs_path _desc _H _upload_date _J _K _version _M _last_version _O _P _Q _R _S _T _U _V _W _X _Y _Z
             _AA _AB _AC _AD _AE _AF _AG _AH _AI _AJ _AK _AL _AM _AN _AO _AP _AQ _AR _AS _AT _AU _AV _AW _AX _AY _AZ
             _BA _BB _BC _BD _BE _BF _BG _BH _BI _BJ _BK _BL _BM _BN _BO _BP _BQ _order _BS _BT _BU _BV _BW _BX _BY _BZ
             _CA _CB _CC _CD _CE _CF _CG _CH _CI _CJ _CK _CL _CM _CN _CO _CP _CQ _CR _CS _CT _CU _CV _CW _CX _CY _CZ
             _DA _DB _DC _size _DE _DF _DG _DH _DI _DJ _DK _DL _DM _DN _DO
bp_key = e_file

[t__1_already_only]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 't') and item.get('_bpk') == u'e_file'
condition2 = python: item['_mail_id'] in storage['data']['e_mail_i'] and item['_last_version'] != '0'

[t__1_i_only]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 't') and item.get('_bpk') == u'e_file'
condition2 = python: item['_mail_id'] in storage['data']['e_mail']

[t__1_upload_date_modify]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 't') and item.get('_bpk') == u'e_file'
key = string:creation_date
value = python:item['_upload_date'][:-4]

[t__1_dmsfile_check]
blueprint = imio.transmogrifier.iadocs.common_input_checks
bp_key = e_file
condition = python: item.get('_bpk') == u'e_file'
clean_value = _filename python:u'\n' " " "python:[]" python:u''
hyphen_newline = _desc
invalids = _fs_path ??
booleans = _last_version
dates = creation_date "%Y%m%d %H:%M:%S" 0

[t__1_with_path]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 't') and item.get('_bpk') == u'e_file'
condition2 = python: item['_fs_path']

[t__batched]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 't') and item.get('_bpk') == u'e_file'
condition2 = python:not storage['batch_nb'] and True or (item['_eid'] not in storage['data']['e_dmsfile_i'] and storage.get('count', {}).get('t__count', {}).get('e_dmsfile_i', {}).get('c', 0) < storage['batch_nb'])

[t__1_dmsfile_creation]
blueprint = imio.transmogrifier.iadocs.t_1_dmsfile_creation
condition = python: item.get('_bpk') == u'e_file'
bp_key = e_dmsfile_i
store_key = e_mail_i

[t__1_path_insert]
blueprint = imio.transmogrifier.iadocs.path_insert
condition = python: item.get('_bpk') == u'e_dmsfile_i'
bp_key = e_dmsfile_i
id_keys = _eid

[t__count]
blueprint = imio.transmogrifier.iadocs.count
group_key = _bpk
condition = python: item.get('_bpk') == u'e_dmsfile_i'

# = = = = = = =  uu  = = = = = = = #

[u__need]
blueprint = imio.transmogrifier.iadocs.need_other
parts =

[u__pickle_file_o_w]
blueprint = imio.transmogrifier.iadocs.pickle_data
filename = 2_e_mail_file_o.pkl
store_key = e_dmsfile_o
d_condition = python:storage['commit'] is True

[u__1_already_only]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'u') and item.get('_bpk') == u'e_file'
condition2 = python: item['_mail_id'] in storage['data']['e_mail_o'] and item['_last_version'] != '0'

[u__1_upload_date_modify]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'u') and item.get('_bpk') == u'e_file'
key = string:creation_date
value = python:item['_upload_date'][:-4]

[u__1_dmsfile_check]
blueprint = imio.transmogrifier.iadocs.common_input_checks
bp_key = e_file
condition = python: item.get('_bpk') == u'e_file'
clean_value = _filename python:u'\n' " " "python:[]" python:u''
hyphen_newline = _desc
invalids = _fs_path ??
booleans = _last_version
dates = creation_date "%Y%m%d %H:%M:%S" 0

[u__1_with_path]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'u') and item.get('_bpk') == u'e_file'
condition2 = python: item['_fs_path']

[u__batched]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'u') and item.get('_bpk') == u'e_file'
condition2 = python:not storage['batch_nb'] and True or (item['_eid'] not in storage['data']['e_dmsfile_o'] and storage.get('count', {}).get('u__count', {}).get('e_dmsfile_o', {}).get('c', 0) < storage['batch_nb'])

[u__1_dmsfile_creation]
blueprint = imio.transmogrifier.iadocs.t_1_dmsfile_creation
condition = python: item.get('_bpk') == u'e_file'
bp_key = e_dmsfile_o
store_key = e_mail_o

[u__1_path_insert]
blueprint = imio.transmogrifier.iadocs.path_insert
condition = python: item.get('_bpk') == u'e_dmsfile_o'
bp_key = e_dmsfile_o
id_keys = _eid

[u__count]
blueprint = imio.transmogrifier.iadocs.count
group_key = _bpk
condition = python: item.get('_bpk') == u'e_dmsfile_o'

# = = = = = = =  xx  = = = = = = = #

[x__need]
blueprint = imio.transmogrifier.iadocs.need_other
parts =

[x__pickle_mail_link_w]
blueprint = imio.transmogrifier.iadocs.pickle_data
filename = 2_e_mail_link.pkl
store_key = reply_to
d_condition = python:storage['commit'] is True

[x__1_mail_link_read]
blueprint = imio.transmogrifier.iadocs.csv_reader
#b_condition = python: not modules['os'].path.exists(modules['imio.pyutils.system'].full_path(storage['csvp'], transmogrifier.get('b__mailtype_match_read', {}).get('filename', '_not_found_')))
# filename = eCourriersLiens_test.csv
filename = eCourriersLiens.csv
fieldnames = _A _eid _target_id _comment
bp_key = e_mail_link

[x__1_already_only]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'x') and item.get('_bpk') == u'e_mail_link'
condition2 = python: item['_eid'] in storage['data']['e_mail'] and item['_target_id'] in storage['data']['e_mail']

[x__batched]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'x') and item.get('_bpk') == u'e_mail_link'
condition2 = python:not storage['batch_nb'] and True or ((item['_eid'] not in storage['data']['reply_to'] or item['_target_id'] not in storage['data']['reply_to'][item['_eid']])
             and storage.get('count', {}).get('x__count', {}).get('reply_to', {}).get('c', 0) < storage['batch_nb'])

[x__1_reply_to_update]
blueprint = imio.transmogrifier.iadocs.x_1_reply_to_update
condition = python: modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'x') and item.get('_bpk') == u'e_mail_link'
store_key = e_mail

[x__count]
blueprint = imio.transmogrifier.iadocs.count
group_key = _bpk
condition = python: item.get('_bpk') == u'reply_to'

[x__1_batch_store]
blueprint = imio.transmogrifier.iadocs.store_in_data
condition = python: item.get('_bpk') == u'reply_to'
bp_key = reply_to
store_key = _eid
store_subkey = _target_id
fieldnames = _eid
yield = 1


# = = = = = = =  end  = = = = = = = #

[count1]
blueprint = imio.transmogrifier.iadocs.count
group_key = _bpk

[count_entries]
blueprint = imio.transmogrifier.iadocs.count
group_key =
condition = python: '${config:to_treat}'

[skip_entries]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: '${config:to_treat}'
condition2 = python: storage.get('count', {}).get('count_entries', {}).get('', {}).get('c', 0) <= int(${config:to_treat})

[skip_commit_entries]
blueprint = imio.transmogrifier.iadocs.condition
condition1 = python: '${config:to_treat}'
condition2 = python: storage.get('count', {}).get('commit_count', {}).get('', {}).get('c', 0) <= int(${config:to_treat})-1

[creators_insert]
blueprint = imio.transmogrifier.iadocs.inserter
condition = python: '${config:creator}' and item.get('_type') and item.get('_path') and modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'dlptu')
key = string:creators
value = string:${config:creator}

[constructor]
blueprint = collective.transmogrifier.sections.constructor
# needs _path and _type

[schemaupdater]
blueprint = transmogrify.dexterity.schemaupdater

[datesupdater]
blueprint = plone.app.transmogrifier.datesupdater

[ownerset]
blueprint = imio.transmogrifier.iadocs.owner_set
condition = python: '${config:creator}' and item.get('_type') and item.get('_path') and modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'dlptu')
owner = ${config:creator}

[l__state_set]
blueprint = imio.transmogrifier.iadocs.state_set
condition = python: item.get('_bpk') == u'e_mail_i'
workflow_id = incomingmail_workflow
state_id = closed
action_id = close
replace = created
date_key = creation_date
actor = ${config:creator}

[p__state_set]
blueprint = imio.transmogrifier.iadocs.state_set
condition = python: item.get('_bpk') == u'e_mail_o'
workflow_id = outgoingmail_workflow
state_id = sent
action_id = mark_as_sent
replace = created
date_key = creation_date
actor = ${config:creator}

[reindexobject]
blueprint = plone.app.transmogrifier.reindexobject

[workflowupdater]
blueprint = plone.app.transmogrifier.workflowupdater

[workflow_history_update]
blueprint = imio.transmogrifier.iadocs.workflow_history_update
condition = python: '${config:creator}' and item.get('_type') and item.get('_path') and modules['imio.transmogrifier.iadocs.utils'].is_in_part(transmogrifier, 'dlptu')
owner = ${config:creator}

[commit_count]
blueprint = imio.transmogrifier.iadocs.count
condition = python:True or transmogrifier.storage['commit']
group_key =

[post_actions]
blueprint = imio.transmogrifier.iadocs.post_actions

[lastsection]
blueprint = imio.transmogrifier.iadocs.last_section

[short_log]
blueprint = imio.transmogrifier.iadocs.short_log

[breakpoint]
# run ipdb if condition is matched
blueprint = imio.transmogrifier.iadocs.breakpoint
# condition = python:item.get('_service_id', u'') == u'333'
condition = python:item.get('_eid', None) in (u'0150', u'')
# condition = python:True
# condition = python:item.get('_bpk') == u'e_category' and item['_code'].startswith('1.824.508')

[stop]
# raise an error to stop the pipeline
blueprint = imio.transmogrifier.iadocs.stop
condition = python:True

[continue]
# never yield the item to the next section
blueprint = collective.transmogrifier.sections.condition
condition = python:False
